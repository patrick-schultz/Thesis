% -*- root: thesis.tex -*-

\chapter{Algebraic weak factorization systems}\label{Ch:Awfs}

For this section, let $\mathbb{D}=\Sq(\mathcal{D})$ be the double category of squares in a 2-category $\mathcal{D}$. We will show that bimonoids in $\FFD$ are precisely algebraic weak factorization systems, and more generally that the morphisms in $\mathrm{Bimon}(\FFD)$ are given by (co)lax morphisms of algebraic weak factorization systems.

Suppose that $E=(E,\eta,\epsilon)$ is a functorial factorization on a category $\cat{C}$, and consider a monoid structure on $E$. As $I_C$ is initial, the unit of the monoid is forced, and is simply $\eta$. The multiplication is given by a natural transformation $\mu\colon ER\Rightarrow E$ satisfying equations~\eqref{Eq:FF2CellA} and~\eqref{Eq:FF2CellB}, which now take the form $\epsilon\circ\mu = \epsilon R$ and $\mu\circ(\eta\cdot\vec{\eta})=\eta$.

The unit axioms for the monoid give the equations $\mu\circ E\vec{\eta}=\id_E=\mu\circ\eta R$, which together imply the equation $\mu\circ(\eta\cdot\vec{\eta})=\eta$ above. And finally, writing $\vec{\mu}=\mu^R\colon R^2\to R$ for the natural transformation induced by the 2-cell $\mu$, the associativity axiom gives the equation $\mu\circ E\vec{\mu}=\mu\circ\mu R$.

\begin{proposition}
	A monoid structure on an object $(E,\eta,\epsilon)$ in $\FFD$ is given by a natural transformation $\mu\colon ER\Rightarrow E$, satisfying equations
	\begin{equation}
		\epsilon\circ\mu=\epsilon R \qquad 
			\mu\circ E\vec{\eta}=\id_E=\mu\circ\eta R \qquad 
			\mu\circ E\vec{\mu}=\mu\circ\mu R.
	\end{equation}
	This determines a monad $\mathbb{R}=(R,\vec{\eta},\vec{\mu})$, such that $\dom\vec{\mu}=\mu$ and $\cod\vec{\mu}=\id_{\cod}$.

	Similarly, a comonoid structure on $(E,\eta,\epsilon)$ is given by a natural transformation $\delta\colon E\Rightarrow EL$, satisfying equations
	\begin{equation}
		\delta\circ\eta=\eta L \qquad 
			E\vec{\epsilon}\circ\delta=\id_E=\epsilon L\circ\delta \qquad
			E\vec{\delta}\circ\delta=\delta L\circ\delta,
	\end{equation}
	which determines a comonad $\mathbb{L}=(L,\vec{\epsilon},\vec{\delta})$, such that $\dom\vec{\delta}=\id_{\dom}$ and $\cod\vec{\delta}=\delta$.
\end{proposition}

Hence a functorial factorization which simultaineously has a monoid structure and a comonoid structure in $\FFD$ is precisely a weak factorization system, missing only the second bullet of \cref{Def:Awfs}, the distributive law condition. This is not surprising, as it is the only condition requiring a compatability between the monad and comonad structures. We will see that a bialgebra in $\FFD$ adds precisely this compatibility.

\begin{proposition}
	A bimonoid structure on a horizontal morphism $(E,\eta,\epsilon)\colon C\to C$ in $\FFD$ is precisely an algebraic weak factorization system on $C$ with underlying functorial factorization system $(E,\eta,\epsilon)$. 
\end{proposition}
\begin{proof}
	We have already shown how the monoid an comonoid structures give rise to the monod and comonad of the awfs. All that remains is to show that the equations~\eqref{Eq:Bimonoid} amount to just the distributive law, i.e. the equation
	\begin{equation}\label{Eq:AwfsDistributiveLaw}
	\begin{tikzcd}[row sep=tiny, bend angle=30, baseline=(B.base)]
		& C^2 \drar{L} \ar[bend left]{drr}[domB]{E} &&\\
		|[alias=B,alias=domA]| C^2 \urar{R} \drar[swap]{L} 
			&& |[alias=codA,alias=codB,alias=domC]| C^2 \rar{E} & C \\
		& C^2 \urar[swap]{R} \ar[bend right]{urr}[codC,swap]{E} &&
		\twocellA{\Delta}
		\twocellB[pos=.4]{\delta}
		\twocellC[pos=.55]{\mu}
	\end{tikzcd}
	=
	\begin{tikzcd}[row sep=2ex, column sep=small, bend angle=25, baseline=(B.base)]
		& |[alias=domA]| C^2 \drar[bend left]{E} & \\
		|[alias=B]| C^2 \urar[bend left]{R}
			\ar{rr}[codA,domB,description]{E}
			\drar[bend right][swap]{L}
		&& C. \\
		& |[alias=codB]| C^2 \urar[bend right][swap]{E} &
		\twocellA{\mu}
		\twocellB[pos=.45]{\delta}
	\end{tikzcd}
	\end{equation}

	First of all, notice that the first three equations of~\eqref{Eq:Bimonoid} follow trivially from the initiality of $I_C$ and the terminality of $\perp_C$ in $\FFD$, hence they do not impose any further conditions.

	The fourth equation here takes the form
	\[
	\begin{tikzcd}
		C^2 \rar[][domA]{R} \dar[equal]
			& C^2 \ar{rr}[domB]{E} \dar[equal]
			&& C \dar[equal] \\
		C^2 \rar[][codA,swap]{R_{E\odot E}} \dar[equal]
			& |[alias=domC]| C^2 \rar{L}
			& |[alias=codB]| C^2 \rar[][domD]{E} \dar[equal]
			& C \dar[equal] \\
		C^2 \rar[][domE]{L_{E\otimes E}} \dar[equal]
			& |[alias=codC]| C^2 \rar[swap]{R} \dar[equal]
			& |[alias=domF]| C^2 \rar[][codD,swap]{E}
			& C \dar[equal] \\
		C^2 \rar[][codE,swap]{L} & C^2 \ar{rr}[codF,swap]{E} && C
		\twocellA{\delta^R}
		\twocellB{\delta}
		\twocellC{w}
		\twocellD{\id_E}
		\twocellE{\mu^L}
		\twocellF{\mu}
	\end{tikzcd}
	=
	\begin{tikzcd}
		C^2 \rar{R} \dar[equal]
			& |[alias=domA]| C^2 \rar{E}
			& C \dar[equal] \\
		C^2 \ar{rr}[codA,domB]{E} \dar[equal]
			&& C \dar[equal] \\
		C^2 \rar[swap]{L} 
			& |[alias=codB]| C^2 \rar[swap]{E} 
			& C,
		\twocellA{\mu}
		\twocellB{\delta}
	\end{tikzcd}
	\]
	and so to prove~\eqref{Eq:AwfsDistributiveLaw}, it suffices to show that
	\[
	\begin{tikzcd}[row sep=tiny, baseline=(B.base)]
		{} & C^2 \drar[bend left=20]{L} & \\
		|[alias=B,alias=domB]| C^2 \urar[bend left=60][domA]{R}
				\urar[][codA,sloped,swap,pos=0.2,inner sep=.2ex]{R_{E\odot E}}
				\drar[][domC,sloped,pos=0.2,inner sep=.2ex]{L_{E\otimes E}}
				\drar[bend right=60][codC,swap]{L}
			&& |[alias=codB]| C^2 \\
		{} & C^2 \urar[bend right=20][swap]{R} &
		\twocellA{\delta^R}
		\twocellB{w}
		\twocellC{\mu^L}
	\end{tikzcd}
	=
	\begin{tikzcd}[row sep=0ex, column sep=4ex, bend angle=15, baseline=(B.base)]
		{} & C^2 \drar[bend left]{L} & \\
		|[alias=B,alias=domA]| C^2 \urar[bend left]{R}
				\drar[bend right][swap]{L}
			&& |[alias=codA]| C^2. \\
		{} & C^2 \urar[bend right][swap]{R} &
		\twocellA{\Delta}
	\end{tikzcd}
	\]
	We can check this using the universal property of $C^2$ by composing with $\dom$ and $\cod$. First, use~\eqref{Eq:DomW} and~\eqref{Eq:CodW} to check that
	\begin{gather*}
	\begin{tikzcd}[row sep=tiny, baseline=(B.base),ampersand replacement=\&]
		{} \& C^2 \drar[bend left=20]{L} \&\& \\
		|[alias=B,alias=domB]| C^2 \urar[bend left=60][domA]{R}
				\urar[][codA,sloped,swap,pos=0.2,inner sep=.2ex]{R_{E\odot E}}
				\drar[][domC,sloped,pos=0.2,inner sep=.2ex]{L_{E\otimes E}}
				\drar[bend right=60][codC,swap]{L}
			\&\& |[alias=codB]| C^2 \rar{\dom} \& C \\
		{} \& C^2 \urar[bend right=20][swap]{R} \&\&
		\twocellA{\delta^R}
		\twocellB{w}
		\twocellC{\mu^L}
	\end{tikzcd}
	=
	\begin{tikzcd}[baseline=(B.base),ampersand replacement=\&]
		C^2 \ar[bend left=55]{rr}[domA]{E}
				\rar[bend left=30][domB]{L}
				\rar[bend right=30][codB,domC,swap,inner sep=0.5pt]{L_{E\otimes E}}
				\rar[bend right=85,looseness=2][codC,swap]{L}
			\& |[alias=codA]| C^2 \rar[swap]{E} \& C
		\twocellA[pos=.45]{\delta}
		\twocellB{i^L}
		\twocellC[pos=.65]{\mu^L}
	\end{tikzcd}
	\\
	\begin{tikzcd}[row sep=tiny, baseline=(B.base),ampersand replacement=\&]
		{} \& |[alias=domB]| C^2 \drar[bend left=20]{L} \&\& \\
		|[alias=B]| C^2 \urar[bend left=60][domA]{R}
				\urar[][codA,sloped,swap,pos=0.2,inner sep=.2ex]{R_{E\odot E}}
				\drar[][domC,sloped,pos=0.2,inner sep=.2ex]{L_{E\otimes E}}
				\drar[bend right=60][codC,swap]{L}
			\&\& C^2 \rar{\cod} \& C \\
		{} \& |[alias=codB]| C^2 \urar[bend right=20][swap]{R} \&\&
		\twocellA{\delta^R}
		\twocellB{w}
		\twocellC{\mu^L}
	\end{tikzcd}
	=
	\begin{tikzcd}[baseline=(B.base),ampersand replacement=\&]
		C^2 \rar[bend left=85,looseness=2][domA]{R}
				\rar[bend left=30][codA,domB,inner sep=0.5pt]{R_{E\odot E}}
				\rar[bend right=30][codB,swap]{R}
				\ar[bend right=55]{rr}[codC,swap]{E}
			\& |[alias=domC]| C^2 \rar{E} \& C.
		\twocellA[pos=.4]{\delta^R}
		\twocellB{p^R}
		\twocellC[pos=.55]{\mu}
	\end{tikzcd}
	\end{gather*}
	Then use the definitions of $i$ and $p$ to check that $\mu\circ i=\mu\circ\eta R=\id_E$ and $p\circ\delta=\epsilon L\circ\delta=\id_E$, so that the first row above just equals $\delta$, and the second row equals $\mu$. Since $\Delta$ also (by definition) satisfies $\dom\Delta=\delta$ and $\cod\Delta=\mu$, we are done.
\end{proof}

The appropriate notion of morphism between awfs, analagous to left/right Quillen functors and Quillen adjunctions, is (to our knowledge) first given in~\cite{riehl:nwfs-model}.

\begin{definition}
	Suppose that $(E_1,\eta_1,\mu_1,\epsilon_1,\delta_1)$ and $(E_2,\eta_2,\mu_2,\epsilon_2,\delta_2)$ are awfs on $\cat{C}$ and $\cat{D}$ respectively. 
	\begin{itemize}
		\item A \emph{lax morphism of awfs} $(G,\rho)\colon E_1\to E_2$ consists of a functor $G\colon\cat{C}\to\cat{D}$ and a natural transformation $\rho\colon E_2\hat{G}\Rightarrow GE_1$, such that $(1,\rho)\colon L_2\hat{G}\Rightarrow GL_1$ is a lax morphism of comonads and $(\rho,1)\colon R_2\hat{G}\Rightarrow GR_1$ is a lax morphism of monads.
		\item A \emph{colax morphism of awfs} $(F,\lambda)\colon E_1\to E_2$ consists of a functor $F\colon\cat{C}\to\cat{D}$ and a natural transformation $\lambda\colon FE_1\Rightarrow E_2\hat{F}$, such that $(1,\lambda)\colon FL_1\Rightarrow L_2\hat{F}$ is a colax morphism of comonads and $(\lambda,1)\colon FR_1\Rightarrow R_2\hat{F}$ is a colax morphism of monads.
	\end{itemize}
\end{definition}

Notice that a lax morphism of awfs induces a lift of the functor $\hat{G}$ to a functor $\mathbb{R}_1\mathrm{Alg}\to \mathbb{R}_2\mathrm{Alg}$. In that sense, $G$ ``preserves the right class,'' so is analagous to a right Quillen functor. Similarly, a colax morphism of awfs induces a lift of $\hat{F}$ to $\mathbb{L}_1\mathrm{Coalg}\to\mathbb{L}_2\mathrm{Coalg}$, so is analagous to a left Quillen functor.

By \cref{Prop:BimonCyclic}, the cyclic action on $\FFD$ induces a cyclic action on $\Bimon(\FFD)$. This action is given on awfs by
\[
	(E,\eta,\mu,\epsilon,\delta)^{\bullet} = (E^{\bullet},\epsilon^{\bullet},\delta^{\bullet},\eta^{\bullet},\mu^{\bullet})
\]
swapping the monad and comonad structures. This cyclic action allows us to capture both types of morphism of awfs in the same structure.

\begin{proposition}
	Morphisms in $\mathrm{Bimon}(\FFD)$ are precisely the colax morphisms of awfs. A colax morphism
	\[
		(E_2,\eta_2,\mu_2,\epsilon_2,\delta_2)^{\bullet} \to (E_1,\eta_1,\mu_1,\epsilon_1,\delta_1)^{\bullet}
	\]
	is equivalent to a lax morphism of awfs
	\[
		(E_1,\eta_1,\mu_1,\epsilon_1,\delta_1) \to (E_2,\eta_2,\mu_2,\epsilon_2,\delta_2)
	\]
\end{proposition}
\begin{proof}
	As above, let $(E_1,\eta_1,\mu_1,\epsilon_1,\delta_1)$ and $(E_2,\eta_2,\mu_2,\epsilon_2,\delta_2)$ be awfs on $\cat{C}$ and $\cat{D}$ respectively. A morphism of bimonoids is given by a 2-cell
	\[
	\begin{tikzcd}[column sep=large]
		\cat{C} \rar[tick][domA]{(E_1,\eta_1,\epsilon_1)} \dar[swap]{F}
			& \cat{C} \dar{F} \\
		\cat{D} \rar[tick][codA,swap]{(E_2,\eta_2,\epsilon_2)}
			& \cat{D}
		\twocellA{\lambda}
	\end{tikzcd}
	\]
	which commutes with the monoid and comonoid structures. It is straightforward to check that this implies the natural transformations
	\[
	\begin{tikzcd}
		\cat{C}^2 \rar[][domA]{L_1} \dar[swap]{\hat{F}}
			& \cat{C}^2 \dar{\hat{F}} \\
		\cat{D}^2 \rar[][codA,swap]{L_2}
			& \cat{D}^2
		\twocellA{\lambda^L}
	\end{tikzcd}
	\qquad
	\begin{tikzcd}
		\cat{C}^2 \rar[][domA]{R_1} \dar[swap]{\hat{F}}
			& \cat{C}^2 \dar{\hat{F}} \\
		\cat{D}^2 \rar[][codA,swap]{R_2}
			& \cat{D}^2
		\twocellA{\lambda^R}
	\end{tikzcd}
	\]
	are colax morphisms of comonads and monads respectively.
\end{proof}